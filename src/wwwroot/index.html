<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Planning Bord</title>
    <base href="/" />
    <link rel="stylesheet" href="css/app.css" />
  </head>

  <body>
    <div id="app"></div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="js/app-interop.js"></script>
    <script>
        // Immediate Theme Application to prevent flash
        (function() {
            var theme = localStorage.getItem('theme_preference') || 'system';
            if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        })();

        // Legacy helpers maintained for compatibility if needed, otherwise delegating to app-interop
        function saveAsFile(filename, contentBase64, contentType) {
            var link = document.createElement('a');
            link.download = filename;
            link.href = "data:" + (contentType || "application/octet-stream") + ";base64," + contentBase64;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        function getSetting(key) {
            try { return localStorage.getItem(key) || ""; } catch { return ""; }
        }
        function setSetting(key, value) {
            try { localStorage.setItem(key, value); } catch {}
        }
        function notify(title, body) {
            try {
                if (!("Notification" in window)) return;

                // Backward compatibility: allow notify("message") and notify("title", "body")
                var resolvedTitle = title;
                var resolvedBody = body;
                if (resolvedBody === undefined || resolvedBody === null) {
                    resolvedBody = String(title ?? "");
                    resolvedTitle = "The Planning Bord";
                }

                if (Notification.permission === "granted") {
                    new Notification(resolvedTitle, { body: resolvedBody });
                } else if (Notification.permission !== "denied") {
                    Notification.requestPermission().then(function (permission) {
                        if (permission === "granted") {
                            new Notification(resolvedTitle, { body: resolvedBody });
                        }
                    });
                }
            } catch {}
        }
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // Success
            }, function(err) {
                console.error('Async: Could not copy text: ', err);
            });
        }
        function getUserAgent() {
            return navigator.userAgent;
        }
        function resetApp() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                console.log("App storage cleared.");
            } catch (e) {
                console.error("Failed to clear storage", e);
            }
        }
    </script>
  </body>
</html>
