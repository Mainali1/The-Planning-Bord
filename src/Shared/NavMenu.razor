@using Microsoft.AspNetCore.Components.Authorization
@inject ThePlanningBord.Services.ISystemService SystemService
@inject ThePlanningBord.Services.IBusinessConfigurationService BusinessConfigurationService

<nav class="bg-gray-800 w-full flex-shrink-0 flex flex-col justify-between min-h-full">
    <div class="mt-5">
        <div class="flex items-center justify-center mb-8">
            <span class="text-white text-2xl font-semibold">@companyName</span>
        </div>
        
        <div class="px-2 space-y-1">
            <NavLink href="" Match="NavLinkMatch.All" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                <span class="mr-3">ğŸ“Š</span>
                Dashboard
            </NavLink>

            @if (businessType == "product-only" || businessType == "both")
            {
                <NavLink href="inventory" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">ğŸ“¦</span>
                    Inventory
                </NavLink>

                <AuthorizeView Roles="CEO,Manager">
                    <NavLink href="suppliers" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                        <span class="mr-3">ğŸ­</span>
                        Suppliers
                    </NavLink>
                </AuthorizeView>
            }

            @if (businessType == "service-only" || businessType == "both")
            {
                <AuthorizeView Roles="CEO,Manager">
                    <NavLink href="services" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                        <span class="mr-3">ğŸ”§</span>
                        Services
                    </NavLink>
                </AuthorizeView>

                <AuthorizeView Roles="CEO,Manager">
                    <NavLink href="clients" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                        <span class="mr-3">ğŸ‘¥</span>
                        Clients
                    </NavLink>
                </AuthorizeView>

                <AuthorizeView Roles="CEO,Manager">
                    <NavLink href="contracts" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                        <span class="mr-3">ğŸ“œ</span>
                        Contracts
                    </NavLink>
                </AuthorizeView>

                <AuthorizeView Roles="CEO,Manager">
                    <NavLink href="quotes" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                        <span class="mr-3">ğŸ’¬</span>
                        Quotes
                    </NavLink>
                </AuthorizeView>

                <AuthorizeView Roles="CEO,Manager">
                    <NavLink href="resource-planning" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                        <span class="mr-3">ğŸ—“ï¸</span>
                        Resource Planning
                    </NavLink>
                </AuthorizeView>

                <NavLink href="time-tracking" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">â±ï¸</span>
                    Time Tracking
                </NavLink>
            }
 
             <AuthorizeView Roles="CEO,Manager,Technical">
                 <NavLink href="tools" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                     <span class="mr-3">ğŸ”§</span>
                     Tools
                 </NavLink>
             </AuthorizeView>

            <AuthorizeView Roles="CEO,Manager">
                <NavLink href="employees" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">ğŸ‘¥</span>
                    Employees
                </NavLink>

                <NavLink href="finance" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">ğŸ’°</span>
                    Finance
                </NavLink>
            </AuthorizeView>

            <AuthorizeView>
                <NavLink href="tasks" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">âœ…</span>
                    Tasks
                </NavLink>

                <NavLink href="projects" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">ğŸš€</span>
                    Projects
                </NavLink>

                <NavLink href="attendance" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">ğŸ•’</span>
                    Attendance
                </NavLink>
            </AuthorizeView>

            <AuthorizeView Roles="CEO,Manager">
                <NavLink href="reports" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">ğŸ“ˆ</span>
                    Reports
                </NavLink>
            </AuthorizeView>
            
            <AuthorizeView Roles="CEO,Technical">
                <NavLink href="integrations" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">ğŸ”—</span>
                    Integrations
                </NavLink>
            </AuthorizeView>

            <AuthorizeView>
                <NavLink href="complaints" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">ğŸ“¢</span>
                    Complaints
                </NavLink>

                <NavLink href="help" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                    <span class="mr-3">â“</span>
                    Help
                </NavLink>
            </AuthorizeView>
        </div>
    </div>
    
    <div class="px-2 pb-5">
         <AuthorizeView Roles="CEO,Technical">
             <NavLink href="settings" class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white" ActiveClass="bg-gray-900 text-white">
                <span class="mr-3">âš™ï¸</span>
                Settings
            </NavLink>
         </AuthorizeView>
    </div>
</nav>

@code {
    private string companyName = "Planning Bord";
    private string businessType = "product-only"; // Default to product-based

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var name = await SystemService.GetCompanyNameAsync();
            if (!string.IsNullOrWhiteSpace(name))
            {
                companyName = name;
            }
            
            // Get business configuration
            var config = await BusinessConfigurationService.GetBusinessConfigurationAsync();
            if (config != null)
            {
                businessType = config.BusinessType?.ToLower() ?? "product-only";
            }
        }
        catch
        {
            // Ignore and keep defaults
        }
    }
}
